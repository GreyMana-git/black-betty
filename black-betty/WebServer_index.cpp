#include "WebServer.h"

#include <sys/pgmspace.h>

static const char webpage_index_local[] PROGMEM = R"###(
<!DOCTYPE html><html><head><meta charset="utf-8"><title>Gaggia Black Betty</title><script>parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"PHZP":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{a(n.next(e))}catch(t){i(t)}}function u(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,u)}a((n=n.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(u){i=[6,u],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};function r(e){return"http://localhost:8080"===window.origin?"http://esp-grey"+e:window.origin+e}function n(e,t){var r=4*e;return{current:t[r],min:t[r+1],max:t[r+2],average:t[r+3]}}function o(o){return e(this,void 0,Promise,function(){var e,i,s,u,a,c;return t(this,function(t){switch(t.label){case 0:return[4,window.fetch(r("/status"),{method:"GET"})];case 1:return[4,t.sent().json()];case 2:for(e=t.sent(),i={id:e.id,token:e.token,isDebug:e.isDebug,isCountdownMode:e.isCountdownMode,temperature:e.temperature,pid:e.pid,heater:e.heater,window:e.window||1e3,history:[]},s=e.history.samples.length,u=0;u<s;u++)i.history.push({sequence:e.history.sequence[u],samples:e.history.samples[u],temperature:n(u,e.history.temperature),output:n(u,e.history.output),heater:n(u,e.history.heater),health:n(u,e.history.health)});return null!=o&&(a=i.history.map(function(e){return e.sequence}),(c=i.history).push.apply(c,o.history.filter(function(e){return-1===a.indexOf(e.sequence)}))),i.history=i.history.slice(0,120),[2,i]}})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getStatus=exports.getApiUri=void 0,exports.getApiUri=r,exports.getStatus=o;
},{}],"mAKB":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,u){function a(e){try{i(r.next(e))}catch(t){u(t)}}function c(e){try{i(r.throw(e))}catch(t){u(t)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,c)}i((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,u,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return u={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){a=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){a.label=u[1];break}if(6===u[0]&&a.label<o[1]){a.label=o[1],o=u;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(u);break}o[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.execute=void 0;var n=require("./Status");function r(r,o){return e(this,void 0,Promise,function(){var e,u,a,c;return t(this,function(t){switch(t.label){case 0:e="TOKEN "+r.getToken()+" "+o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,window.fetch(n.getApiUri("/command"),{method:"POST",body:e})];case 2:return[4,t.sent().json()];case 3:return u=t.sent(),a=u.success,c=u.message,r.notify(a?"Successfully executed command":"Error executing command",c),[3,5];case 4:return t.sent(),[3,5];case 5:return[2]}})})}exports.execute=r;
},{"./Status":"PHZP"}],"tmWP":[function(require,module,exports) {
"use strict";var t=this&&this.__assign||function(){return(t=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.HistoryGraph=void 0;var e=function(){function e(e,i,n){this.element=window.document.getElementById("graph-"+e),this.property=e,this.axisInfo=t({},n);var o=parseInt(i,16);this.color={r:o>>16&255,g:o>>8&255,b:255&o}}return e.prototype.getColor=function(t){return void 0===t&&(t=1),"rgba("+[this.color.r,this.color.g,this.color.b,t].join(",")+")"},e.prototype.resize=function(){var t=this.element.getBoundingClientRect(),e=t.width,i=t.height;this.element.width=e,this.element.height=i;var n=this.element.getBoundingClientRect();e==n.width&&i==n.height||(this.element.width+=e-n.width,this.element.height=i-n.height)},e.prototype.line=function(t,e,i,n,o){t.beginPath(),t.moveTo(e,i),t.lineTo(n,o),t.stroke()},e.prototype.update=function(t,e,i){var n,o=this,r=null===(n=this.element)||void 0===n?void 0:n.getContext("2d");if(null!=r&&null!=t){this.resize();var h={left:48,bottom:20,width:this.element.width-48,fullWidth:this.element.width,height:this.element.height-20,min:this.axisInfo.min,max:this.axisInfo.max},l=[];t.history.slice(0,e).forEach(function(t){var e=t[o.property];h.min=Math.min(h.min,e.min),h.max=Math.max(h.max,e.max),l.push(e)});for(var a={x:[],xy1:h.height,xy2:0,y:[],yx1:h.left,yx2:h.fullWidth},s=0;s<e;s++)a.x.push({x:c(s),label:(-s*t.window/1e3).toFixed(1)+"s"});for(s=Math.floor(h.min/this.axisInfo.yStep)*this.axisInfo.yStep;s<h.max;s+=this.axisInfo.yStep)a.y.push({y:x(s),label:s+this.axisInfo.unit});r.clearRect(0,0,this.element.width,this.element.height),r.lineWidth=1,r.strokeStyle="rgba(32, 32, 32, 0.10)",a.x.forEach(function(t,e){e%i==0&&o.line(r,t.x,a.xy1,t.x,a.xy2)}),a.y.forEach(function(t){return o.line(r,a.yx1,t.y,a.yx2,t.y)}),r.font="16px sans-serif",r.strokeStyle=r.fillStyle="rgb(32, 32, 32)",this.line(r,c(0),x(0),c(e-1),x(0)),this.line(r,c(e-1),x(h.min),c(e-1),x(h.max)),r.textAlign="center",a.x.forEach(function(t,e){e%i==0&&r.fillText(t.label,t.x,a.xy1+16)}),r.textAlign="right",a.y.forEach(function(t){return r.fillText(t.label,a.yx1-4,t.y)});var f=l[0];r.fillStyle=this.getColor(.15),r.beginPath(),r.moveTo(c(0),x(f.max)),l.forEach(function(t,e){r.lineTo(c(e),x(t.max))}),l.slice().reverse().forEach(function(t,e){r.lineTo(c(l.length-e-1),x(t.min))}),r.fill(),r.strokeStyle=this.getColor(.5),r.beginPath(),r.moveTo(c(0),x(f.average)),l.forEach(function(t,e){r.lineTo(c(e),x(t.average))}),r.stroke(),r.strokeStyle=this.getColor(),r.lineWidth=2,r.beginPath(),r.moveTo(c(0),x(f.current)),l.forEach(function(t,e){r.lineTo(c(e),x(t.current))}),r.stroke(),r.font="12px sans-serif",r.textAlign="center",r.strokeStyle=r.fillStyle="rgb(32, 32, 32)",l.forEach(function(t,e){if(e%i==0){var n=c(e),h=x(t.current);r.beginPath(),r.arc(n,h,3,0,2*Math.PI),r.fill(),r.fillText(t.current.toFixed(2)+o.axisInfo.unit,n,h-10)}})}function c(t){var i=(e-t-1)/(e-1)*h.width;return h.left+Math.floor(Math.max(0,Math.min(h.width,i)))+.5}function x(t){var e=h.height-(t-h.min)/(h.max-h.min)*h.height;return Math.floor(Math.max(0,Math.min(h.height,e)))+.5}},e}();exports.HistoryGraph=e;
},{}],"wj0t":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(s,r){function o(t){try{a(i.next(t))}catch(e){r(e)}}function u(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,u)}a((i=i.apply(t,e||[])).next())})},e=this&&this.__generator||function(t,e){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(r){return function(u){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(u){r=[6,u],i=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,u])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.AppUI=void 0;var n=require("./Status"),i=require("./Command"),s=require("./HistoryGraph"),r=function(){function r(){this.status=null,this.graphs=[],this.active=!0}return r.prototype.init=function(){var n=this;this.graphs.push(new s.HistoryGraph("temperature","ff0000",{min:30,max:150,yStep:10,unit:"℃"})),this.graphs.push(new s.HistoryGraph("output","0000ff",{min:-5,max:200,yStep:50,unit:""})),this.graphs.push(new s.HistoryGraph("heater","00ff00",{min:0,max:1,yStep:.25,unit:""})),this.graphs.push(new s.HistoryGraph("health","ffa000",{min:0,max:50,yStep:10,unit:"ms"})),this.on("overview-toggleEnable","click",function(){return t(n,void 0,void 0,function(){return e(this,function(t){switch(t.label){case 0:return null==this.status?[3,2]:[4,i.execute(this,"SET heater.enabled "+("off"===this.status.heater.mode?"true":"false"))];case 1:t.sent(),t.label=2;case 2:return[2]}})})}),this.on("setting-open","click",function(){return t(n,void 0,void 0,function(){var t,n;return e(this,function(e){return null!=(t=this.get("setting-panel"))&&null!=this.status&&((n=this.setText.bind(this))("setting-temperature-low",this.status.temperature.low),n("setting-temperature-high",this.status.temperature.high),n("setting-pid-kp",this.status.pid.kp),n("setting-pid-ki",this.status.pid.ki),n("setting-pid-kd",this.status.pid.kd),n("setting-toggle-countdown",this.status.isCountdownMode?"Disable Countdown":"Enable Countdown"),t.classList.remove("slide-out"),t.classList.add("slide-in")),[2]})})}),this.on("setting-close","click",function(){var t=n.get("setting-panel");null!=t&&(t.classList.remove("slide-in"),t.classList.add("slide-out"))}),this.on("setting-apply-temperature","click",function(){return t(n,void 0,void 0,function(){var t,n;return e(this,function(e){switch(e.label){case 0:return t=parseFloat(this.getText("setting-temperature-low")),n=parseFloat(this.getText("setting-temperature-high")),[4,i.execute(this,"SET heater "+t+" "+n)];case 1:return e.sent(),[2]}})})}),this.on("setting-apply-pid","click",function(){return t(n,void 0,void 0,function(){var t,n,s;return e(this,function(e){switch(e.label){case 0:return null==this.status?[3,2]:(t=parseFloat(this.getText("setting-pid-kp")),n=parseFloat(this.getText("setting-pid-ki")),s=parseFloat(this.getText("setting-pid-kd")),[4,i.execute(this,"SET pid "+t+" "+n+" "+s)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})}),this.on("setting-toggle-countdown","click",function(){return t(n,void 0,void 0,function(){var t;return e(this,function(e){switch(e.label){case 0:return null==this.status?[3,2]:(t=!this.status.isCountdownMode,[4,i.execute(this,"SET countdown_mode "+t.toString())]);case 1:e.sent(),this.setText("setting-toggle-countdown",t?"Disable Countdown":"Enable Countdown"),e.label=2;case 2:return[2]}})})}),this.on("setting-save","click",function(){return t(n,void 0,void 0,function(){return e(this,function(t){switch(t.label){case 0:return[4,i.execute(this,"SAVE")];case 1:return t.sent(),[2]}})})}),this.on("setting-restart","click",function(){return t(n,void 0,void 0,function(){return e(this,function(t){switch(t.label){case 0:return[4,i.execute(this,"RESTART")];case 1:return t.sent(),[2]}})})}),window.addEventListener("blur",function(){n.active=!1}),window.addEventListener("focus",function(){n.active=!0});var r=this.get("notify-panel");null!=r&&(r.style.display="none")},r.prototype.update=function(){return t(this,void 0,Promise,function(){var t,i,s,r,o,u,a=this;return e(this,function(e){switch(e.label){case 0:return this.active?(t=this,[4,n.getStatus(this.status)]):[2];case 1:return t.status=e.sent(),null==this.status?[2]:(i=this.status,s=i.temperature,r=i.pid,o=i.heater,(u=this.setText.bind(this))("overview-temperature",s.current.toFixed(3)),u("overview-mode",o.mode),u("overview-toggleEnable","off"===o.mode?"Enable":"Disable"),u("temperature-current",s.current),u("temperature-target",s.target),u("temperature-low",s.low.toFixed(1)),u("temperature-high",s.high.toFixed(1)),u("pid-kp",r.kp.toFixed(3)),u("pid-ki",r.ki.toFixed(3)),u("pid-kd",r.kd.toFixed(3)),u("pid-input",r.input.toFixed(3)),u("pid-output",r.output.toFixed(3)),u("pid-setpoint",r.setpoint.toFixed(3)),u("heater-mode",o.mode),u("heater-active",o.active),this.graphs.forEach(function(t){return t.update(a.status,15,1)}),[2])}})})},r.prototype.getToken=function(){var t;return(null===(t=this.status)||void 0===t?void 0:t.token)||0},r.prototype.notify=function(t,e){var n=this.get("notify-panel");null!=n&&(n.style.display="none",n.classList.remove("fade-out"),this.setText("notify-header",t),this.setText("notify-message",e),window.setTimeout(function(){n.classList.add("fade-out"),n.style.display="block"},5))},r.prototype.get=function(t){return window.document.getElementById(t)},r.prototype.setText=function(t,e){"number"==typeof e?e=e.toString():"boolean"==typeof e&&(e=e.toString());var n=this.get(t);n instanceof HTMLInputElement?n.value=e:n instanceof HTMLElement&&(n.textContent=e)},r.prototype.getText=function(t){var e=this.get(t);return e instanceof HTMLInputElement?e.value||"":e instanceof HTMLElement&&e.textContent||""},r.prototype.on=function(t,e,n){var i;null===(i=this.get(t))||void 0===i||i.addEventListener(e,n)},r}();exports.AppUI=r;
},{"./Status":"PHZP","./Command":"mAKB","./HistoryGraph":"tmWP"}],"QCba":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function u(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,u)}c((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(u){a=[6,u],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("./src/AppUI");window.document.addEventListener("DOMContentLoaded",function(){var e=new n.AppUI;e.init();Date.now();window.setInterval(function(){return e.update()},1e3)});
},{"./src/AppUI":"wj0t"}]},{},["QCba"], null)
</script><style>body{font-family:sans-serif;font-size:16px;margin:0;color:#0d0d0d}header{padding:16px;color:#f9f9fa;background-color:#0d0d0d;font-size:64px;line-height:64px;box-shadow:0 4px 2px -2px rgba(0,0,0,.6)}header .logo{display:inline-block;text-align:center;width:64px;height:64px}header .logo img{position:relative;top:-8px}h1{margin:0;font-size:32px}#tokeninfo{font-size:18px;color:#404040;float:right}.panel{width:100%;max-width:1024px;margin:16px auto;padding:8px;background-color:#ebe9e1;box-shadow:4px 4px 2px -2px rgba(0,0,0,.6);box-sizing:border-box}.panel .panel-content{display:grid;grid-template-columns:108px 1fr}.graph-wrapper{position:relative;padding-top:50%;height:0}.graph{position:absolute;left:0;top:0;width:100%;height:100%}.overview-grid{display:grid;grid-template-columns:2fr 1fr}.overview .overview-value{font-size:64px;display:inline-block;width:50%;text-align:right}.panel .side-grid div:nth-of-type(odd){font-weight:700}.panel .side-grid div:nth-of-type(2n){padding-bottom:12px}.setting-panel{position:fixed;top:0;left:-50%;width:50%;height:100%;box-shadow:4px 0 2px -2px rgba(0,0,0,.6);background-color:#fff;padding:24px;overflow-y:auto;box-sizing:border-box}.slide-in{animation:slide-in .3s forwards}@keyframes slide-in{to{left:0}}.slide-out{animation:slide-out .3s forwards}@keyframes slide-out{0%{left:0}to{left:-50%}}.wrapper:hover #slide{transition:1s;left:0}#setting-open{cursor:pointer}.setting-close{float:right;cursor:pointer}.setting-panel h2{padding-top:24px}.setting-panel .setting-grid div:nth-of-type(odd){font-size:24px;font-weight:700}.setting-panel .setting-grid div:nth-of-type(2n){padding-bottom:24px}input[type=text]{padding:0 8px;background-color:#f9f9fa;border:1px solid #0d0d0d;width:100%;box-sizing:border-box}button,input[type=text]{height:40px;font-size:24px}button{background-color:#106ebe;color:#f9f9fa;padding:4px 16px;border:0;width:33%;margin:0 0 0 auto;display:block;cursor:pointer}button:hover{background-color:#2080f0}button#setting-restart{background-color:#be4e10}button#setting-restart:hover{background-color:#f06020}.notify-panel{position:fixed;right:16px;bottom:16px;width:384px;height:128px;background-color:#fff;padding:8px;border:1px solid #ebe9e1;box-shadow:4px 4px 2px -2px rgba(0,0,0,.6)}.notify-panel #notify-header{font-weight:700;padding-bottom:12px}.fade-out{animation:fade-out 4s forwards}@keyframes fade-out{0%{opacity:1}75%{opacity:1}to{opacity:0}}
</style></head><body> <header> <div class="logo" id="setting-open"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAANNSURBVEhLnZa7NutBFMZ3chQai07j1lt0GqFUEKWGeAB0KpfqVMIDoFO5PEDkBVwewCUNVdBQoVPNmd93sv9rJHEuvrXGzOz/nj3fvsyOXFdXV7BvolQq2ebmpp2dndny8rJkef39JlZWVmx8fNx6enpsdHRUsr8aRLG7u7uxa8Xb25tm1/mjwYGBATs5ObGdnZ2G5Gu4YSOGfX19YWtrK8RYhMPDwzA/Px+Qn56eah2VpYMsHQ8PD5L7jCwP1Wq1qhv29/ctflSwj4+PbWJiQuP19VV7Ag/rdnCGP9bX13/e39/b1NSUdXZ22urqqrEn0M/Pz9bb25spj42N2dzcnL28vNjd3Z3Nzs7ax8eHjYyM2MHBgXQ6EJbLZRlYW1tTcGF1c3MjZjBOQWavr6+1Pj8/V9mEEOQdZzswhBuuNDk5aTF2+oibHEpB1tE5OjrSvl6v2+DgoAwSkjwHcImbMdDf3y9XgF/i4BLcwwPWjphQGYRcnptIAi6SnGKxaFdXV2LmsXNwEXrv7+9au3cYRzdWxO+yiYfD0tJSDEXQmpGWB6NQKIR4kUqrUqloHd0NMzMzYW9vLzsjgwgRRLY62M4gsrQWh4eHRYA19epn9FLiRi4xey22QxoCdB4fH21jY0Ox9m9ZtyFzfEQxuvApIU9PTy0JcpBhwHdiKIYElZSTPcqATDbDGUQvtU5nkuheySC1RfYWFhZ0I2ybAQMu4yD97+LiQjMyXOdRgKzbUC7c6AdTODuMMSgX4DMPwSGDuEgN4jKHeYopeIJfNYWhoaFPBJQUTwbDg4/rrHGfGFPI/twcEOFbSqCjMeuRcxMKGKOEiC3u8JJ2d3db3jXAqxRZDDnow0uACwi2s/4XyCDxc2b+Y8P+O5BBGBAPjwklROyY/xfZS4EZz44sY5QEETPqjR8qLm123buNuowDgz5oEvEQb16gA7ks1aGB+J5Og8z3Lf85XF5eZk8PliSG2HrJeBl5MZPl7e3trAI+GUSxVqupRFJwCKM0DYBR1iQz/shlctDCEKOeaUANYoA48TPhDQTkcjmL7mrtyOrQQVKgz/CsT09PiwUyWN3e3qrVwboZLQxTkN3Y7m1xcVGsaVO8XS7xdezcDW1g9guTdXCwgupdzgAAAABJRU5ErkJggg=="> </div> <span>Gaggia Black Betty</span> <span id="tokeninfo">0</span> </header> <div class="content"> <div class="panel overview"> <h1>Overview</h1> <div class="overview-grid"> <div class="side-grid"> <div>Current temperature:</div> <div class="overview-value"><span id="overview-temperature"></span>&#8451;</div> </div> <div class="side-grid"> <div>Current Mode:</div> <div class="overview-value"><span id="overview-mode"></span></div> <div> <button id="overview-toggleEnable">Enable</button> </div> </div> </div> </div> <div class="panel temperature"> <h1>Temperature</h1> <div class="panel-content"> <div> <div class="side-grid"> <div>Current:</div><div><span id="temperature-current"></span> &#8451;</div> <div>Target:</div><div><span id="temperature-target"></span> &#8451;</div> <div>Low:</div><div><span id="temperature-low"></span> &#8451;</div> <div>High:</div><div><span id="temperature-high"></span> &#8451;</div> </div> </div> <div class="graph-wrapper"> <canvas class="graph" id="graph-temperature"></canvas> </div> </div> </div> <div class="panel pid"> <h1>PID Status</h1> <div class="panel-content"> <div class="side-grid"> <div>kp:</div><div id="pid-kp"></div> <div>ki:</div><div id="pid-ki"></div> <div>kd:</div><div id="pid-kd"></div> <div>Input:</div><div id="pid-input"></div> <div>Output:</div><div id="pid-output"></div> <div>Setpoint:</div><div id="pid-setpoint"></div> </div> <div class="graph-wrapper"> <canvas class="graph" id="graph-output"></canvas> </div> </div> </div> <div class="panel heater"> <h1>Heater Relay</h1> <div class="panel-content"> <div class="side-grid"> <div>Mode:</div><div id="heater-mode"></div> <div>Active:</div><div id="heater-active"></div> </div> <div class="graph-wrapper"> <canvas class="graph" id="graph-heater"></canvas> </div> </div> </div> <div class="panel heater"> <h1>Health (ms in loop)</h1> <div class="panel-content"> <div></div> <div class="graph-wrapper"> <canvas class="graph" id="graph-health"></canvas> </div> </div> </div> </div> <div id="setting-panel" class="setting-panel"> <h1>Settings<span class="setting-close" id="setting-close">&#10006;</span></h1> <div class="setting-grid"> <h2>Temperature</h2> <div>Low Temperature</div> <div><input type="text" id="setting-temperature-low"></div> <div>High Temperature</div> <div><input type="text" id="setting-temperature-high"></div> <button id="setting-apply-temperature">Apply</button> <h2>PID</h2> <div>kp</div> <div><input type="text" id="setting-pid-kp"></div> <div>ki</div> <div><input type="text" id="setting-pid-ki"></div> <div>kd</div> <div><input type="text" id="setting-pid-kd"></div> <button id="setting-apply-pid">Apply</button> <h2>System</h2> <button id="setting-toggle-countdown" style="float:left;"></button> <button id="setting-save">Save</button> <div style="height:24px">&nbsp;</div> <button id="setting-restart">Restart</button> </div> </div> <div id="notify-panel" class="notify-panel"> <div id="notify-header"></div> <div id="notify-message"></div> </div> </body></html>
)###";

const __FlashStringHelper* WebServer::webpage_index_content = reinterpret_cast<const __FlashStringHelper*>(webpage_index_local);
